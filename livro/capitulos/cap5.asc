[[cap5]]
== Introdução à Análise Combinatória

*A Análise Combinatória* (ou, simplesmente, _Combinatória_) é o ramo da Matemática que analisa estruturas e relações discretas, nelas procurando determinar métodos de contagem ou de enumeração (termos aqui usados no sentido de determinar o número de elementos de um conjunto e de atribuir números naturais a seus elementos).

*Nosso objetivo, nesta unidade*, é, primeiramente, você (relembrar e voltar a) dominar as técnicas de contagem e enumeração mais conhecidas (que são as de combinações, arranjos e permutações) de subconjuntos de um conjunto _finito_ e que satisfazem certas condições dadas. (Como você, com suficiente carga horária e profundidade, já estudou isso no ensino médio e para o recente vestibular, então, quanto à teoria, faremos apenas uma sucinta revisão em ritmo acelerado, quase sem nenhuma prova de fórmulas e teoremas; mas faremos muitos exemplos de resoluções de problemas, que são tudo o que pediremos nos exames.) 

A seguir, procuraremos lhe dar um panorama informativo sobre alguns dos outros mais importantes métodos de contagem (estes são difíceis para este seu primeiro período na universidade, não exigiremos completo domínio deles nos exames).
A importância da Combinatória na Ciência da Computação decorre do fato de que um considerável número de problemas muito frequentemente encontrados são redutíveis a apenas alguns poucos problemas básicos de contagem, que se apresentam sob variados ``disfarces''. 

.Sempre vamos repetir
[TIP]
====
Estamos torcendo por você. O fórum de alunos, os tutores, e eu (o professor) queremos e vamos ajudá-lo (nessa ordem), mas você tem que ser determinado e disciplinado, *cada semana dedicando 4 a 8 horas para estudar este livro*.
====

.Conteúdo deste capítulo
____________________
* Técnicas Básicas de Contagem. Permutações, Arranjos, Combinações
* Relações de Recorrência
* Coeficientes Binomiais
* Outras Sequências de Contagem
* Teorema de Ramsey
____________________

[NOTE]
====
Devido à sua concisão e objetividade, pegamos o ``jeitão'', o esqueleto mestre e ordem de apresentação, a escolha de tópicos do capítulo 6 do livro ``_Programming Challenges_'', de Steven S. Skiena e Miguel A. Revilla, muito útil, que pode ser encontrado na Internet para download gratuito (mas que, repetimos, é muito conciso e denso).

Se você quiser ver o assunto mais explicada e profundamente do que aqui, não precisará de mais que os livros textos da ementa da disciplina. Se quiser ir ainda mais profundo que eles, recomendo um livro específico, http://pt.scribd.com/doc/99378433/Analise-Combinatoria-e-Probabilidade-Augusto-Cesar-de-Oliveira-Morgado-Pedro-Fernandez-1991, particularmente seu capítulo 2, que tem 24 ótimos exemplos, todos eles resolvidos, sobre combinações e permutações. *Este livro contém a teoria e as provas de todas as fórmulas aqui usadas*, e elas também foram vistas no ensino médio, por isso omitiremos muitas delas e recomendamos que os eventuais interessados as vejam ali, ou nos livros texto desta disciplina. A notação dos assuntos que cobriremos e que você pode procurar nessas fontes incluem: latexmath:[$P(n), Pc(n), Pr(n,r), P(n,(n_a,n_b,\ldots)), K(n), A(n,r), A(n,n_1,r,r_1), C(n,r), Cr(n,r),$] etc. 

Agradecemos aos Profs. Paulo Roberto Rezende e Rômulo Garcia, do Projeto Rumo ao ITA, uma parte do Sistema Elite de Ensino, por muitos dos exemplos e problemas propostos, que entendemos que são questões de passados vestibulares ao ITA e ao IME. Você pode encontrar muitas e boas videoaulas sobre o assunto, mas gostei mais de
http://www.youtube.com/watch?v=VInwxDcFWaQ (Prof. Gui, 22 min de exercícios sobre Algarismos, Permutações e Anagramas) e http://www.youtube.com/watch?v=VK_ThpOO6TE (Prof. Gui, 22 min de exercícios sobre Arranjos e Combinações). Preparei 2 videoaulas: http://www.youtube.com/watch?v=eCG18ODYuEY (problema composto: Registro de Empregados); http://www.youtube.com/watch?v=Yms9aqPTQsU (problema composto: Trem).
====

//_

=== Técnicas Básicas de Contagem. Permutações, Arranjos, Combinações

*Regra do produto* (ou *Princípio Fundamental da Enumeração*): Se há latexmath:[$\vert A \vert$] possibilidades no conjunto latexmath:[$A$] e há latexmath:[$\vert B \vert$] possibilidades no conjunto latexmath:[$B$], então há latexmath:[$\vert A \vert \times \vert B \vert$] maneiras de combinar uma possibilidade de latexmath:[$A$] e uma de latexmath:[$B$].

Generalizando, se há latexmath:[$n$] conjuntos latexmath:[$A_i$], cada um com latexmath:[$m_i$] elementos (distintos, claro), e temos que escolher 1 elemento de cada um dos latexmath:[$n$] conjuntos, cada escolha sendo independente de todas as outras, então o número total de possibilidades é latexmath:[$m_1 \times m_2 \times \cdots \times m_n$].

Por exemplo, suponha que o conjunto latexmath:[$A_1$] é constituído por 5 camisas e o conjunto latexmath:[$A_2$] por 4 calças. Então, há latexmath:[$5 \times 4 = 20$] maneiras diferentes de você escolher 1 camisa e 1 calça.

Rosen reexpressa assim: Suponha-se que um procedimento consista em se fazer as tarefas latexmath:[$T_1, T_2, \ldots , T_m$] (nesta ordem). Se a tarefa latexmath:[$T_i$] pode ser feita de latexmath:[$n_i$] maneiras após as tarefas latexmath:[$T_1, T_2, \ldots \mbox{ e } T_{i-1}$] terem sido feitas, então existem latexmath:[$n_1 \times n_2 \times \cdots n_m$] formas de realizar o procedimento.

.(Morgado-Carvalho-Carvalho-Fernandez):
====
Quantos números naturais de três algarismos distintos (na base 10) existem (assumimos que não começam por 0)?

{zwsp} +
*Solução:* O primeiro algarismo pode ser escolhido de 9 modos (não podemos usar o 0), o segundo de 9 modos (não podemos usar o algarismo utilizado anteriormente) e o terceiro de 8 modos (não podemos usar os dois algarismos já empregados anteriormente). A resposta é latexmath:[$9 \times 9 \times 8 = 648$]. (Sempre devemos começar tratando o conjunto que tenha a escolha de seu elemento independente das escolhas dos elementos dos outros conjuntos, se for o primeiro conjunto onde se faz a escolha, mas que tenha a escolha mais difícil se ela for deixada para depois. Isto, neste problema, é a escolha do primeiro algarismo: se começássemos da direita para a esquerda, ao chegarmos ao primeiro algarismos teríamos 8 escolhas se o 0 já tivesse sido escolhido, e 7 em caso contrário.)
====

NOTE: Mais de 10 exemplos que se seguem também servem de exemplos de aplicação da regra do produto.

*Regra da Soma:* Se há latexmath:[$\vert A \vert$] possibilidades no conjunto latexmath:[$A$] e há latexmath:[$\vert B \vert$] possibilidades no conjunto latexmath:[$B$], então há latexmath:[$\vert A \vert + \vert B \vert$] formas para latexmath:[$A$] ou latexmath:[$B$] ocorrerem, assumindo-se que os elementos de latexmath:[$A$] são diferentes dos de latexmath:[$B$]. Generalizando, dados os conjuntos latexmath:[$A_1, A_2, \ldots, A_n$], em que latexmath:[$A_i$] tem exatamente latexmath:[$a_i$] elementos, então o número de elementos da união latexmath:[$A_1 \cup A_2 \cup \cdots \cup A_n$] é dado por latexmath:[$a_1 + a_2 + a_3 + \cdots + a_n$].

Por exemplo, dado que você possui 5 camisas e 4 calças, e a lavanderia telefona avisando que arruinou uma peça de suas roupas, sem dizer mais nada, então há 9 itens possíveis com a possibilidade de terem sido arruinados.

.{zwsp}
====
Uma senha de usuário de um sistema computacional pode ser formada por sequências (portanto a ordem, as posições importam) de 5 a 13 caracteres, cada um deles (inclusive o primeiro) podendo ser letra maiúscula, letras minúscula, um dos 10 dígitos, sublinhado, ponto, hífen, e jogo da velha, totalizando latexmath:[$26+26+10+4 = 66$] caracteres diferentes, sendo que repetições são permitidas. Quantas senhas diferentes existem?

{zwsp} +
*Solução:*
O conjunto de todas as senhas é formado pelo subconjunto das senhas de 5 caracteres, união o subconjunto das senhas de 6 caracteres, união ... , união o subconjunto das senhas de 13 caracteres. (Como veremos ao estudar permutações com repetições) o primeiro subconjunto tem latexmath:[$66^5$] possibilidades, o segundo latexmath:[$66^6$], etc. A resposta é a soma: latexmath:[$\sum_{i=5}^{13}66^i \cong 4,57827 \times 10^{23}$].
====

(Mais de 5 exemplos que se seguem também servem de exemplos de aplicação da regra da soma)

*Fórmula da Inclusão-Exclusão:* A regra de soma é um caso especial de uma fórmula mais geral, chamada de Fórmula de Inclusão-Exclusão. Para dois conjuntos que podem se sobrepor, ela é:

[width="100%",cols=">.^,<.^",frame="none",grid="none"]
|====
|image:images/cap5/img01-union.eps[width="100"] |latexmath:[$\vert A \cup B \vert = \vert A \vert + \vert B \vert - \vert A \cap B \vert$]
|====

A fórmula de inclusão-exclusão pode ser generalizada para três conjuntos e além, de uma forma natural.

.Para quatro conjuntos:
[NOTE]
====
{zwsp} +
latexmath:[$\vert A \cup B \cup C \cup D \vert  =  \vert A \vert + \vert B \vert + \vert C \vert + \vert D \vert - \vert A \cap B \vert - \vert A \cap C \vert  - \vert A \cap D \vert - \vert B \cap C \vert - \vert B \cap D \vert - \vert C \cap D \vert + \vert A \cap B \cap C \vert + \vert A \cap B \cap D \vert  +  \vert A \cap C \cap D \vert + \vert B \cap C \cap D \vert - \vert A \cap B \cap C \cap D \vert  $]
====

*Generalizando:* o número de elementos da união de n conjuntos é obtido quando somamos o número de elementos de cada conjunto, subtraímos o número de elementos das interseções dos conjuntos tomados 2 a 2, somamos o número de elementos das interseções dos conjuntos tomados 3 a 3, subtraímos o número de elementos das interseções dos conjuntos tomados 4 a 4 e, assim, sucessivamente.

.(R. Garcia):
====
Quantos são os anagramas da palavra CADERNO (note que esta palavra tem 7 letras, todas distintas) que têm C em 1º lugar, ou A em 2º lugar, ou D em 3° lugar, ou E em 4º lugar?

{zwsp} +
*Solução:* 

Inicialmente, definamos os conjuntos:

* latexmath:[$A_1$]: conjunto cujos elementos são os anagramas da palavra CADERNO que têm a letra C em 1º lugar
* latexmath:[$A_2$]: conjunto cujos elementos são os anagramas da palavra CADERNO que têm a letra A em 2º lugar
* latexmath:[$A_3$]: conjunto cujos elementos são os anagramas da palavra CADERNO que têm a letra D em 3º lugar
* latexmath:[$A_4$]: conjunto cujos elementos são os anagramas da palavra CADERNO que têm a letra E em 4º lugar

Queremos determinar latexmath:[$\vert A_1 \cup A_2 \cup A_3 \cup A_4 \vert$]. Temos:

* Quanto aos 4 conjuntos isolados: latexmath:[$\vert A_1 \vert = \vert A_2 \vert = \vert A_3 \vert = \vert A_4 \vert = P(6) = 6! = 720$] (fixar 1 letra e permutar as 6 demais)
* Quanto aos 6 conjuntos de interseções de 2 conjuntos: latexmath:[$\vert A_1 \cap A_2 \vert = \vert A_1 \cap A_3 \vert = \vert A_1 \cap A_4 \vert = \vert A_2 \cap A_3 \vert = \vert A_2 \cap A_4 \vert = \vert A_3 \cap A_4 \vert = P(5) = 5! = 120$] (fixar 2 letras e permutar as 5 demais)
* Quanto aos 4 conjuntos de interseções de 3 conjuntos: latexmath:[$\vert A_1 \cap A_2 \cap A_3 \vert = \vert A_1 \cap A_2 \cap A_4 \vert = \vert A_1 \cap A_3 \cap A_4 \vert = \vert A_2 \cap A_3 \cap A_4 \vert = P(4) = 4! = 24$] (fixar 3 letras e permutar as 4 demais)
* Quanto aos 1 conjunto de interseção dos 42 conjuntos: latexmath:[$\vert A_1 \cap A_2 \cap A_3 \cap A_4 \vert = P(3) = 3! = 6$] (fixar 4 letras e permutar as 3 demais).

Pela fórmula da inclusão-exclusão, temos:

[latexmath]
++++
\[ \vert A_1 \cup A_2 \cup A_3 \cup A_4 \vert = 4 \times 720 - 6 \times 120 + 4 \times 24 - 1 \times 6 = 2250 \]
++++
 
Logo, temos 2250 anagramas da palavra CADERNO com as restrições impostas pelo enunciado.
====


(_Indevida_) *Dupla contagem* é um aspecto escorregadio da combinatória, o que pode tornar difícil a resolução de problemas através da fórmula de inclusão-exclusão. Outra técnica poderosa é estabelecer uma bijeção. 

* *Bijeção* é um mapeamento um-a-um entre (todos) os elementos de um conjunto e (todos) os elementos de outro. Sempre que você tem tal mapeamento, contar o tamanho de um dos conjuntos automaticamente lhe dá o tamanho do outro conjunto. +
Por exemplo, se contarmos o número de todos os pares de sapatos que, neste instante, estão sendo usados em um determinado pelotão de soldados (e podemos assumir que cada soldado usa exatamente 1 par de sapatos, e cada par de sapatos é usado exatamente por 1 soldado), então isso nos diz qual é o número de soldados no pelotão. Isto funciona porque há um mapeamento um-a-um entre pares de sapatos e soldados, e poderia falhar se estivéssemos falando de número de objetos no bolso alto da camisa (que pode ser 0, 1, 2, ou 3, em cada soldado).

Explorar bijeções nos obriga a ter um repertório de conjuntos que sabemos como contar, para que possamos mapear outros objetos para eles. Os objetos combinatoriais básicos com os quais você deve estar familiarizado incluem os seguintes (e é útil ter um sentimento de quão rapidamente o número de objetos cresce, para saber quando busca exaustiva torna-se uma técnica inviável):

Podemos formar latexmath:[$2^n$] subconjuntos (distintos, claro) através de selecionarmos (sem repetição) elementos de um conjunto de latexmath:[$n$] elementos (distintos, claro).

* *Subconjuntos:* Podemos formar latexmath:[$2^n$] subconjuntos (distintos, claro) através de selecionarmos (sem repetição) elementos de um conjunto de n elementos (distintos, claro). Por exemplo, existem latexmath:[$2^3 = 8$] subconjuntos de latexmath:[$\{1,2,3\}$], e tais subconjuntos são latexmath:[$\{1\}, \{2\}, \{3\}, \{1,2\}, \{1,3\}, \{2,3\}, \{1,2,3\}$], e o conjunto vazio (nunca esqueça o conjunto vazio). Para latexmath:[$n = 20$], latexmath:[$2^n = 1048576$], então começamos a chegar aos limites (da viabilidade) da busca exaustiva.

* *Permutação Simples* é uma sequência (portanto não somente importam o valor ou natureza dos elementos, mas, também, a ordem, as posições deles) sem repetições, de comprimento n, de elementos tirados de um conjunto de latexmath:[$n$] elementos distintos. O número dessas sequências distintas é +
[width="80%",cols="1<,3<",frame="none",grid="none"]
|====
|latexmath:[$P(n) = n!$], |_leia latexmath:[$P(n)$] como ``permutação simples de latexmath:[$n$] elementos distintos''_
|====

*Prova(1)*, consequência direta da aplicação da regra do produto: temos n modos de escolher o 1º elemento da sequência, latexmath:[$n-1$] modos de escolher o 2º elemento, etc., e a regra do produto nos diz que há latexmath:[$n(n-1)(n-2) \cdots 3 \cdot 2 \cdot 1$] modos de formar a sequência. Isto é, latexmath:[$P(n) = n!$].

*Prova(2)*, por indução: a fórmula vale para latexmath:[$n=1$], pois o número de permutações de 1 elemento é 1, que coincide com o valor dado pela fórmula. Assumamos, agora, que a fórmula vale para latexmath:[$n = m-1$], isto é, latexmath:[$P(m-1) = (m-1)!$] Se provarmos que a fórmula vale para latexmath:[$n=m$], o princípio da indução matemática assegurará que ela valerá para todo latexmath:[$n \geq 1$]. Ora, para cada uma das latexmath:[$P(m-1)$] sequências de latexmath:[$m-1$] elementos, o elemento latexmath:[$m$]-ésimo poderá ser inserido antes do primeiro elemento, ou depois do último, ou em qualquer das latexmath:[$m-2$] fronteiras entre dois elementos vizinhos, portanto em latexmath:[$1+1+(m-2) = m$] locais. Portanto, o número de sequências possíveis, latexmath:[$P(m)$], será latexmath:[$m$] vezes latexmath:[$P(m-1)$], isto é latexmath:[$P(m) = mP(m-1) = m(m-1)! = m!$], de modo que a fórmula vale. C.Q.D.

Note que, para latexmath:[$n = 10, n! = 3628800$], então começamos a chegar aos limites (da viabilidade) da busca exaustiva.

.(Morgado-Carvalho-Carvalho-Fernandez):
====
De quantos modos 5 rapazes e 5 moças podem se sentar em 5 bancos de 2 lugares cada, de modo que em cada banco fique 1 rapaz e 1 moça?

{zwsp} +
*Solução:*

O 1º rapaz pode escolher seu lugar de 10 modos (em 5 bancos de 2 lugares), o 2º rapaz de 8 modos (em 4 bancos), o 3º de 6 modos (...), o 4º de 4 modos (...), e o 5º de 2 modos (...). Colocados os rapazes, temos de colocar as moças nos 5 lugares que sobraram, o que pode ser feito de 5! modos. A resposta é latexmath:[$(10 \times 8 \times 6 \times 4 \times 2) \times 5! = 460800$].
====

A *formação das permutações* de latexmath:[$n \geq 1$] elementos pode ser feita assim (_bottom-up_, _forward_):
* a permutação de 1 elemento 1 é 1;
* para formar as latexmath:[$n!$] permutações de latexmath:[$\{1,2, \ldots, n\}$], tome cada uma das latexmath:[$(n-1)!$] permutações de latexmath:[$\{1,2, \ldots ,n-1\}$] e, em cada uma, insira latexmath:[$n$] antes dela e imprima, depois insira latexmath:[$n$] entre o 1º e 2º elemento dela e imprima, etc., insira latexmath:[$n$] depois da latexmath:[$(n-1)$]-ésima posição dela e imprima. +
Por exemplo: as permutações de 1 elemento são somente uma: 1;as permutações de 2 elementos são duas: 21, 12; as permutações de 3 elementos são seis : 321, 231, 213, 312, 132, 123; etc.
Os algoritmos mais simples têm um tempo de execução que, no pior caso, é assintoticamente proporcional a latexmath:[$n!$]). Os mais sofisticados, têm latexmath:[$O(\lg{(n!)})$] (http://journal.dyu.edu.tw/dyujo/document/setjournal/s05-4-21-29.pdf).

.Desafio
[NOTE]
====
Só para sua satisfação, quando tiver tempo sobrando: note como a regra de formação acima vista deriva da prova por indução da fórmula latexmath:[$P(n) = n!$], e vice-versa.
====

.Desafio
[NOTE]
====
Só para sua satisfação, quando souber programar bem: escreva e teste um programa que implemente a regra de formação acima. 
====

.Desafio
[NOTE]
====
Só para sua satisfação, quando souber programar bem: Examine em http://www.geeksforgeeks.org/lexicographic-permutations-of-string/ a regra de Dijkstra para gerar as permutações em ordem lexicográfica (muito interessante), e faça e teste um programa para isso, finalmente compare-o com o da mesma URL (a versão otimizada é latexmath:[$O(n \cdot n!)$]).
====

* *Permutação (Simples) Circular* é uma permutação simples de latexmath:[$n$] elementos distintos colocados formando um círculo (se duas permutações coincidem girando-se o circulo, não são distintas). O número dessas permutações distintas é +
[width="80%",cols="1<,3<",frame="none",grid="none"]
|====
|latexmath:[$Pc(n) = (n-1)!$] |_leia latexmath:[$Pc(n)$] como ``permutação simples e circular de latexmath:[$n$] elementos distintos''_
|====

A *prova* é simples: dos latexmath:[$n$] objetos, o 1º pode ocupar qualquer posição círculo, e, por causa da definição acima, isto não terá efeito sobre a fórmula; restam então, latexmath:[$(n-1)$] posições, que poderão ser ocupadas de latexmath:[$(n-1)(n-2)(n-3) \cdots 1 = (n-1)!$] diferentes maneiras.

.{zwsp}
====
Seja um grupo de 10 amigos. De quantos modos distintos estes amigos podem sentar-se ao redor de a uma mesa circular sem que haja repetição das posições relativas?

{zwsp} +
*Solução:* latexmath:[$Pc(10) = (10-1)! = 9! = 362880$]
====

* *Permutação Podendo Repetir Elementos* é uma sequência (portanto não somente importam o valor ou natureza dos elementos, mas, também, a ordem, as posições deles) de comprimento r que pode repetir elementos de um conjunto de n elementos distintos. O número dessas distintas permutações é: +
[width="80%",cols="1>,3<",frame="none",grid="none"]
|====
|latexmath:[$Pr(n,r) = n^r$], |_leia latexmath:[$Pr(n,r)$] como ``permutação (podendo ter repetições) de elementos tomados latexmath:[$r$] a latexmath:[$r$]''_
|====

A *prova* da fórmula é uma simples aplicação da regra do produto: o 1º elemento pode ser escolhido de latexmath:[$n$] modos; como repetições são possíveis, então cada um dos 2º, 3º , ... latexmath:[$r$]-ésimo elementos também podem ser escolhidos de latexmath:[$n$] modos; portanto, por tal regra, o número total de possibilidades é o produto de latexmath:[$n$] por si mesmo, latexmath:[$r$] vezes.

.{zwsp}
====
Um teclado de digitação tem 40 teclas, cada uma com somente um símbolo. De quantas maneiras diferentes um macaco doido e cego pode formar uma sequência de 10 símbolos?

{zwsp} +
*Solução:* latexmath:[$40^{10} = (4 \times 10)^{10} = 2^{20} \times 10^{10}4$], um número de 16 dígitos, na ordem de latexmath:[$10^{16} = 10 000 000 000 000 000 = 10$] quintilhões.
====

* *Permutação de Elementos Nem Todos Distintos* é uma sequência (portanto não somente importam o valor ou natureza dos elementos, mas, também, a ordem, as posições deles) de elementos tirados de um grupo de elementos possivelmente repetidos. O número de distintas permutações de latexmath:[$r$] elementos tirados de um grupo de latexmath:[$n$] elementos (havendo latexmath:[$n_a$] elementos latexmath:[$a$], latexmath:[$n_b$] elemento latexmath:[$b$], ..., e sendo latexmath:[$n_a + n_b + \cdots = n$]) é: +
[width="80%",cols=">,<",frame="none",grid="none"]
|====
|latexmath:[$P(n,(n_a,n_b,\ldots ))  =  \frac{n!}{(n_{a}! n_{b}! \cdots)$] 
|===
